points:
  key:
    padding: U # cy
  zones:
    matrix:
      rotate: -15
      mirror: &mirror { ref: matrix_inner_bottom, shift: [10, 100], distance: 40 }

      columns:
        outer:  { key: { column_net: COL0,  mirror.column_net: COL11 } }
        pinky:  { key: { stagger: 0cy,     column_net: COL1,  mirror.column_net: COL10  } }
        ring:   { key: { stagger: 0.61cy,  column_net: COL2,  mirror.column_net: COL9  } }
        middle: { key: { stagger: 0.33cy,  column_net: COL3,  mirror.column_net: COL8  } }
        index:  { key: { stagger: -0.33cy, column_net: COL4,  mirror.column_net: COL7 } }
        inner:  { key: { stagger: -0.14cy, column_net: COL5,  mirror.column_net: COL6 } }

      rows:
        bottom: { row_net: ROW3, mirror.row_net: ROW3 }
        home:   { row_net: ROW2, mirror.row_net: ROW2 }
        top:    { row_net: ROW1, mirror.row_net: ROW1 }
        upper:  { row_net: ROW0, mirror.row_net: ROW0 }

    thumb_cluster:
      mirror: *mirror
      anchor: { ref: matrix_inner_bottom, shift: [-1, -21], rotate: -10 }

      columns:
        t1:
          rows:
            bottom: { column_net: COL3, mirror.column_net: COL8,  row_net: ROW4, mirror.row_net: ROW4 }

        t2:
          key: { stagger: -0.5cy }
          rows:
            bottom: { column_net: COL4, mirror.column_net: COL7, row_net: ROW5, mirror.row_net: ROW5 }
            top:    { column_net: COL4, mirror.column_net: COL7, row_net: ROW4, mirror.row_net: ROW4 }


        t3:
          key: { stagger: -0.5cy }
          rows:
            bottom: { column_net: COL5, mirror.column_net: COL6, row_net: ROW5, mirror.row_net: ROW5 }
            top:    { column_net: COL5, mirror.column_net: COL6, row_net: ROW4, mirror.row_net: ROW4 }

    thumb_solo:
      mirror: *mirror
      anchor: { ref: matrix_inner_bottom, shift: [-2.5cy, -1.14cy], rotate: 0 }

      columns:

        t1:


          rows:
            bottom: { column_net: COL1, mirror.column_net: COL10,  row_net: ROW4, mirror.row_net: ROW4 }

        t2:
          key: { spread: cx+2 }
          rows:
            top: { column_net: COL2, mirror.column_net: COL9, row_net: ROW4, mirror.row_net: ROW4 }

outlines:
  keys:
    - what: rectangle
      where: true
      size: [1cx - 0.5, 1cy - 0.5]
  board:
    - what: rectangle
      size: [340, 160]        # x1 keyboard
      where:
      - aggregate:
          method: average
          parts:
            - ref: matrix_outer_bottom
            - ref: mirror_matrix_outer_bottom
        affect: [x]  
      - aggregate:
          method: average
          parts:
            - ref: matrix_middle_upper
            - ref: thumb_cluster_t3_bottom
        affect: [y]  
  plate:
    - what: rectangle
      where: true
      size: 30  # scalar => used for both width/height
      bevel: 5  



  combined:
    - "^board"
    - "^keys"
    - "^plate"
    

       


pcbs:

  main:
    template: kicad8
    outlines:
      edge:
        outline: board
        layer: Edge.Cuts
    footprints:
      # I am using choc v1
      choc:
        what: ceoloide/switch_choc_v1_v2
        where: true
        params:
          from: "{{colrow}}"
          to: "{{column_net}}"
          include_keycap: true
          keycap_width: 17.5
          keycap_height: 16.5
          choc_v2_support: false
          solder: true
          hotswap: true
        
      diodes:
        what: diode
        where: true
        adjust:
          rotate: 0
          shift: [ 0, -4.5 ]
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"

      mcu:
        what: promicro
        asym: source
        where: { ref: matrix_inner_upper, shift: [20, 20], affect: [x, y] }
        adjust: { rotate: 270 }
        params: 
          orientation: down
          GND: GND
          RAW: RAW
          VCC: VCC
          RST: RST
                    

          P21: COL0
          P20: COL1
          P19: COL2
          P18: COL3
          P15: COL4
          P14: COL5
          P16: ROW0
          P10: ROW1

          P1: COL11
          P0: COL10


          P2: COL9
          P3: COL8
          P4: COL7
          P5: COL6
          P6: ROW5
          P7: ROW4
          P8: ROW3
          P9: ROW2

      reset:
        what: button
        asym: source
        where: { ref: matrix_inner_upper, shift: [40, 30], rotate: 180 } #, affect: [x, y]}
        params: { from: RST, to: GND }
      batt_jst:
        what: jstph
        asym: source
        where: { ref: matrix_inner_upper, shift: [50, 30], affect: [x, y] }
        params: { side: B, pos: BAT+, neg: GND }
      # power:
      #   what: slider
      #   asym: source
      #   where: { ref: matrix_inner_upper, shift: [60, 30], affect: [x, y] }
      #   params: { side: B, from: BAT+, to: RAW }
      pwr_in:
        what: pad
        asym: source
        where: { ref: matrix_inner_upper, shift: [60, 30], affect: [x, y] }
        params: { width: 7, height: 4, front: true, back: false, net: BAT+, text: "+BAT" }
      pwr_out:
        what: pad
        asym: source
        where: { ref: matrix_inner_upper, shift: [65, 30], affect: [x, y] }
        params: { width: 7, height: 4, front: true, back: false, net: RAW, text: "RAW" }
        
      pwr_out_via:
        what: via
        asym: source
        where: { ref: matrix_inner_upper, shift: [65, 31.5], affect: [x, y] }  # place near the pad
        params: { net: RAW }